<div class="grid grid-cols-3 gap-3">
  <!--  Well title card -->
  <div
    class="col-span-2 bg-gradient-cyan-blue p-3 rounded-2xl text-white shadow-sm overflow-hidden hover:shadow-xl transition-shadow duration-300 animate-pulse-shadow"
  >
    <div class="text-[10px] opacity-80 mb-1">Well Name</div>
    <div class="font-bold text-sm leading-tight">THURAYYA - Lg3 / THRY-845</div>
    <div class="text-[10px] opacity-80">SP-276 Drilling Water Supply</div>
  </div>

  <!--  Targeted Aquifer -->
  <div
    class="col-span-1 bg-white p-3 rounded-2xl shadow-sm flex flex-col justify-center border border-slate-100 hover:shadow-xl transition-shadow duration-300"
  >
    <div class="text-[10px] text-slate-500 mb-1">Targeted Aquifer</div>
    <div class="font-bold text-blue-800 flex items-center gap-1">
      <i class="fa-solid fa-droplet text-blue-500"></i> Jafurah
    </div>
  </div>

  <!--  Current status -->
  <div
    class="col-span-2 bg-white p-3 rounded-2xl shadow-sm flex items-center justify-between border border-slate-100 hover:shadow-xl transition-shadow duration-300"
  >
    <div>
      <div class="text-[10px] text-slate-500 mb-1">Current Status</div>
      <div class="font-bold text-blue-800">On Target</div>
    </div>
    <div
      class="bg-gradient-cyan-blue p-2 rounded-full text-white shadow-sm animate-pulse"
    >
      <i class="fa-solid fa-gear animate-spin-slow"></i>
    </div>
  </div>

  <!--  Days indicator -->
  <div
    class="col-span-1 bg-gradient-blue-dark p-3 rounded-2xl text-white shadow-sm flex flex-col justify-center hover:shadow-xl transition-shadow duration-300"
  >
    <div class="flex items-center gap-2 mb-1">
      <i class="fa-regular fa-calendar text-cyan-300"></i>
      <div class="text-[10px] opacity-80">Days</div>
    </div>
    <div class="font-bold text-sm">29.34/49</div>
  </div>

  <!--  Days‑since & Target‑days circles -->
  <div
    class="col-span-2 grid grid-cols-2 gap-3 bg-white p-3 rounded-2xl shadow-sm border border-slate-100 hover:shadow-xl transition-shadow duration-300"
  >
    <div class="text-center">
      <div class="text-[10px] text-slate-500 mb-1">Days since Sup</div>
      <div
        class="w-12 h-12 rounded-full border-4 border-slate-100 border-t-cyan-500 border-r-blue-500 mx-auto flex items-center justify-center shadow-sm bg-white animate-pulse"
      >
        <span class="text-base font-extrabold text-blue-900">42</span>
      </div>
    </div>

    <div class="text-center">
      <div class="text-[10px] text-slate-500 mb-1">Target Days</div>
      <div
        class="w-12 h-12 rounded-full border-4 border-slate-100 border-t-blue-300 mx-auto flex items-center justify-center shadow-sm bg-white animate-pulse"
      >
        <span class="text-base font-extrabold text-blue-900">60</span>
      </div>
    </div>
  </div>

  <!--  Supporting BI -->
  <div
    class="col-span-1 bg-gradient-cyan-blue p-3 rounded-2xl text-white shadow-sm flex flex-col justify-center hover:shadow-xl transition-shadow duration-300"
  >
    <div class="font-bold text-lg leading-none mb-1">BI34</div>
    <div class="text-[10px] opacity-80">Supporting</div>
    <div class="font-bold text-xs">Well THRY-5</div>
  </div>

  <!--  Total footage -->
  <div
    class="col-span-2 bg-gradient-blue-dark p-3 rounded-2xl text-white shadow-sm flex items-center justify-between relative overflow-hidden hover:shadow-xl transition-shadow duration-300"
  >
    <div>
      <div class="font-extrabold text-2xl">9,890</div>
      <div class="text-[10px] opacity-80">Feet</div>
    </div>
    <div class="text-cyan-300 opacity-50 absolute right-2 bottom-0 text-4xl">
      <i class="fa-solid fa-water"></i>
    </div>
    <div class="text-white absolute top-2 right-1/3">
      <i class="fa-solid fa-arrow-down"></i>
    </div>
  </div>

  <!--  Previous well -->
  <div
    class="col-span-1 bg-gradient-cyan-blue p-3 rounded-2xl text-white shadow-sm flex flex-col justify-center hover:shadow-xl transition-shadow duration-300"
  >
    <div class="text-[10px] opacity-80 mb-1">Previous Well</div>
    <div class="font-bold text-sm">THRY-845</div>
  </div>

  <!--  Current depth -->
  <div
    class="col-span-2 bg-gradient-cyan-blue p-3 rounded-2xl text-white shadow-sm flex items-center justify-between hover:shadow-xl transition-shadow duration-300"
  >
    <div class="text-[10px] opacity-80 font-medium">Current Depth (FT.DF)</div>
    <div class="font-extrabold text-2xl">3591</div>
  </div>

  <!-- Next well -->
  <div
    class="col-span-1 bg-gradient-blue-dark p-3 rounded-2xl text-white shadow-sm flex flex-col justify-center hover:shadow-xl transition-shadow duration-300"
  >
    <div class="text-[10px] opacity-80 mb-1">Next Well</div>
    <div class="font-bold text-sm">THRY-841</div>
  </div>
</div>


import { Component, computed, effect, inject, OnInit } from '@angular/core';
import { wellDataStore } from '../../../core/stores/wwell-data/wwell-data.store';
import { MorningReportStore } from '../../../core/stores/moringreport/morning-report.store';

@Component({
  selector: 'app-misc-pres-well-data',
  imports: [],
  templateUrl: './misc-pres-well-data.component.html',
  styleUrl: './misc-pres-well-data.component.scss'
})
export class MiscPresWellDataComponent {
  private readonly reportStore = inject(MorningReportStore);
  private readonly wellDataStore = inject(wellDataStore);

  readonly selectedWellData = computed(() => {
    const activeId = this.reportStore.selectedWellId(); // Dependency 1
    const allData = this.wellDataStore.response()?.data; // Dependency 2

    console.log('Step 2: Misc Component - Computed logic re-running...');
    console.log('Current Selected ID from Store:', activeId);

    if (!allData || !activeId) {
      console.warn('Step 3: Data flow incomplete - Missing Data or ID');
      return null;
    }

    const found = allData.find(item => {
      const wellId = item.DRLG_OP_STATUS?.[0]?.epANum;
      return String(wellId) === String(activeId);
    });

    if (found) {
      console.log('Step 3: Success! Matching data found for well:', found.WELL_MASTER);
    } else {
      console.error('Step 3: Failure - No matching data in array for ID:', activeId);
    }

    return found ?? null;
  });
}
import { Component, computed, effect, inject, input, OnInit } from '@angular/core';
import { MoriningReportService } from '../../../services/morining-report.service';
import { SHARED_MODULES } from '../../../shared/shared.module';
import { MorningReport } from '../../../models/morining-report.model';
import { MorningReportStore } from '../../../core/stores/moringreport/morning-report.store';

@Component({
  selector: 'app-well-chip-list',
  imports: [...SHARED_MODULES],
  providers: [MoriningReportService],
  templateUrl: './well-chip-list.component.html',
  styleUrl: './well-chip-list.component.scss'

})
export class WellChipListComponent implements OnInit {

  private morningReportService = inject(MoriningReportService);
  store = inject(MorningReportStore)
  readonly mode = input<'horizontal' | 'vertical'>('horizontal');
  readonly showAll = input<boolean>(false);
  readonly pageSize = input<number>(5);

  public visibleWells = computed(() => this.store.visibleWells());
  public selectedWellId = computed(() => this.store.selectedWellId());
  public selectedWell = this.store.selectedWell;

  constructor() {
    effect(() => {
      this.store.setConfig(this.showAll(), this.pageSize());
    });
  }


  ngOnInit() {
    this.store.loadMorningReportData();
  }

  public chipCountInfo = computed(() => {
    const selectedId = this.selectedWellId();
    const wells = this.store.wells();
    const index = wells.findIndex(well => well.epANum === selectedId);
    if (index === -1) return '';
    return `Well ${index + 1} of ${wells.length}`;
  });

  public onWellSelect(well: MorningReport) {
    console.log(" well name chip clicked ", well.epANum);
    this.store.selectWell(well.epANum);
  }
}
<header
  class="bg-white h-16 flex items-center justify-between px-4 shadow-sm shrink-0 z-10 relative border-b border-slate-200 mb-5"
>
  <!-- <div class="flex items-center gap-3 min-w-max">
    <button mat-flat-button (click)="store.showAll()" class="view-all-btn">
      <mat-icon>{{
        store.showAll() ? " view_carousel" : "grid_view"
      }}</mat-icon>
      {{ store.showAll() ? "Slider View" : "View All Wells" }}
    </button>
    <div class="h-8 w-px bg-slate-200 mx-2"></div>
  </div> -->

  <div class="flex-1 flex items-center justify-center overflow-hidden px-2">
    @if (!store.showAll()) {
      <button
        mat-icon-button
        (click)="store.navigatePrev()"
        [disabled]="store.selectedWellId() === store.wells()[0].epANum"
        class="nav-arrow"
      >
        <mat-icon>keyboard_arrow_left</mat-icon>
      </button>
    }

    <div class="chips-wrapper" [class.all-mode]="store.showAll()">
      <mat-chip-listbox aria-label="Well selection">
        @for (well of visibleWells(); track well.epANum) {
          <mat-chip-option
            [selected]="well.epANum === selectedWellId()"
            (click)="onWellSelect(well)"
            class="custom-well-chip"
          >
            {{ well.wGnrName }}
          </mat-chip-option>
        }
      </mat-chip-listbox>
    </div>

    @if (!store.showAll()) {
      <button
        mat-icon-button
        (click)="store.navigateNext()"
        [disabled]="
          store.selectedWellId() ===
          store.wells()[store.wells().length - 1].epANum
        "
        class="nav-arrow"
      >
        <mat-icon>keyboard_arrow_right</mat-icon>
      </button>
    }
  </div>

  <div class="flex items-center gap-4 min-w-max ml-4">
    <span class="chip-counter">{{ chipCountInfo() }}</span>
    <div
      class="hidden lg:flex items-center gap-2 text-slate-500 font-medium border-l pl-4"
    >
      <mat-icon class="text-blue-500 scale-75">calendar_today</mat-icon>
      <span class="text-[11px]">15 Feb 2026</span>
    </div>
  </div>
</header>
<div class="main-container">
  <app-well-chip-list
    [mode]="horizontal"
    [pageSize]="5"
    [showAll]="true"
    (selectedChange)="onWellSelect('')"
  ></app-well-chip-list>

  <!-- <mat-chip-listbox class="mat-mdc-chip-set-stacked">
    @for (well of morningReportStore.visibleWells(); track well.epANum) {
      <mat-chip-option
        [selected]="morningReportStore.selectedWellId() === well.epANum"
        (click)="onWellSelect(well.epANum)"
      >
        {{ well.wGnrName }}
      </mat-chip-option>
    }
  </mat-chip-listbox> -->

  <app-wellbore-view></app-wellbore-view>
</div>

<!-- <div class="container">
  <app-scale
    class="scale"
    [maxDepth]="maxDepth"
    [plotHeight]="plotHeight"
    [axisWidth]="70"
  >
  </app-scale>

  <svg
    class="drawing"
    [attr.width]="svgWidth"
    [attr.height]="plotHeight + 100"
    [attr.viewBox]="'0 0 ' + svgWidth + ' ' + (plotHeight + 100)"
  >
    <line
      [attr.x1]="0"
      [attr.y1]="groundLevelY"
      [attr.x2]="svgWidth"
      [attr.y2]="groundLevelY"
      stroke="#c5410a"
      stroke-width="3"
    ></line>
    <text [attr.x]="613" [attr.y]="-11">Ground Level</text>

    <g [attr.transform]="'translate(10,50)'">
      <app-casing></app-casing>

      <app-depth-marks></app-depth-marks>

      <app-water-level></app-water-level>

      <app-open-hole></app-open-hole>

      <app-line-screen></app-line-screen>

      <text
        [attr.x]="613"
        [attr.y]="plotHeight + 45"
        style="font-size: 13px; font-weight: bold"
      >
        Total Depth : {{ totalDepth }} ft
      </text>
    </g>
  </svg>
</div> -->
import { ChangeDetectionStrategy, Component, inject } from '@angular/core';
import { SHARED_MODULES } from '../../shared/shared.module';
import { WellboreViewComponent } from "./wellbore-view/wellbore-view.component";
import { WellChipListComponent } from "./well-chip-list/well-chip-list.component";
import { MorningReportStore } from '../../core/stores/moringreport/morning-report.store';


@Component({
  selector: 'app-persentation',
  imports: [...SHARED_MODULES, WellboreViewComponent, WellChipListComponent],
  templateUrl: './persentation.component.html',
  styleUrl: './persentation.component.scss',
  changeDetection: ChangeDetectionStrategy.OnPush,
})
export class PersentationComponent {

  horizontal: "horizontal" | "vertical" = "horizontal";
  morningReportStore = inject(MorningReportStore);

  onWellSelect(id: string) {
    console.log("executing " + id)
    this.morningReportStore.selectWell(id);
  }

}

import { signalStore, withState, withMethods, patchState } from '@ngrx/signals';
import { computed, inject } from '@angular/core';
import { MoriningReportService } from '../../../services/morining-report.service'
import { MorningReport } from '../../../models/morining-report.model';

interface MorningReportState {
    wells: MorningReport[];
    startIndex: number;
    selectedWellId: string | null;
    chipsPerPage: number;
    showAll: boolean;
}

export const MorningReportStore = signalStore(
    { providedIn: 'root' },
    withState<MorningReportState>({
        wells: [],
        startIndex: 0,
        selectedWellId: null,
        chipsPerPage: 5,
        showAll: false,
    }),
    withMethods((store, service = inject(MoriningReportService)) => ({
        loadMorningReportData() {
            service.getMorningReport().subscribe({
                next: (wells) => {
                    patchState(store, { wells });
                    if (wells.length > 0 && !store.selectedWellId()) {
                        patchState(store, { selectedWellId: wells[0].epANum, startIndex: 0 });
                    }
                },
            });
        },

        setConfig(showAll: boolean, pageSize: number) {
            patchState(store, { showAll, chipsPerPage: pageSize });
        },

        selectWell(id: string) {
            const wells = store.wells();
            const index = wells.findIndex(w => w.epANum === id);
            if (index === -1) return;

            const currentStart = store.startIndex();
            const pageSize = store.chipsPerPage();
            let newStart = currentStart;

            // Adjust window if selection is outside visible range
            if (index < currentStart) {
                newStart = index;
            } else if (index >= currentStart + pageSize) {
                newStart = index - pageSize + 1;
            }
            console.log("MorningReportStore called with ", id);
            patchState(store, { selectedWellId: id, startIndex: newStart });
        },

        navigateNext() {
            const wells = store.wells();
            const currentIndex = wells.findIndex(w => w.epANum === store.selectedWellId());
            if (currentIndex < wells.length - 1) {
                this.selectWell(wells[currentIndex + 1].epANum);
            }
        },

        navigatePrev() {
            const wells = store.wells();
            const currentIndex = wells.findIndex(w => w.epANum === store.selectedWellId());
            if (currentIndex > 0) {
                this.selectWell(wells[currentIndex - 1].epANum);
            }
        }
    })),
    withMethods((store) => ({
        visibleWells: computed(() => {
            if (store.showAll()) return store.wells();
            return store.wells().slice(store.startIndex(), store.startIndex() + store.chipsPerPage());
        }),
        selectedWell: computed(() => store.wells().find(w => w.epANum === store.selectedWellId()))
    }))
);
import { signalStore, withState, withMethods, patchState } from '@ngrx/signals';
import { inject } from '@angular/core';
import { ApiResponse } from '../../models/api-response.model';
import { IWellData } from '../../../models/well-design/wwell-data.model';
import { WwellDataService } from '../../../services/wwell-data.service';
import { LoadingService } from '../../services/loading.service';

interface WellDataState {

    response: ApiResponse<IWellData> | null;
}

export const wellDataStore = signalStore(
    { providedIn: 'root' },
    withState<WellDataState>({ response: null }),
    withMethods(
        (
            store,
            service = inject(WwellDataService),
            loading = inject(LoadingService)
        ) => ({
            // Updated to accept the parameter
            loadWellData: (epNum: string) => {
                loading.show();
                patchState(store, { response: null });

                service.getWellDataByEPANum(epNum).subscribe({
                    next: (res) => {
                        console.log("Well data loaded:", res);
                        patchState(store, { response: res });
                    },
                    error: (err) => {
                        patchState(store, {
                            response: {
                                statusCode: err.status || 500,
                                error: true,
                                message: err.message,
                                data: null as any, // Adjusted to match your IWellData type
                            },
                        });
                    },
                    complete: () => loading.hide()
                });
            },

            // If refresh needs the same epNum, you might want to store epNum in state 
            // or pass it here as well.
            refresh: (epNum: string) => {
                loading.show();
                service.getWellDataByEPANum(epNum).subscribe({
                    next: (res) => patchState(store, { response: res }),
                    error: (err) => patchState(store, { /* handle error */ }),
                    complete: () => loading.hide(),
                });
            },
        })
    )
);

