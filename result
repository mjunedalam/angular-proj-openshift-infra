import { ChangeDetectionStrategy, Component, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { AgGridAngular } from 'ag-grid-angular';
import { ColDef, GetRowIdParams } from 'ag-grid-community';
import { wellDataStore } from '../../core/stores/wwell-data/wwell-data.store';

@Component({
  selector: 'app-picked-formation-tops',
  standalone: true,
  imports: [CommonModule, AgGridAngular],
  templateUrl: './picked-formation-tops.component.html',
  styleUrl: './picked-formation-tops.component.scss',
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class PickedFormationTopsComponent {
  public readonly store = inject(wellDataStore);

  public colDefs: ColDef[] = [
    { 
      headerName: 'Formation', field: 'formation', flex: 1, 
      cellStyle: { backgroundColor: '#48b5d3', color: 'white', fontWeight: '600', borderRight: '1px solid rgba(255,255,255,0.2)' } 
    },
    { 
      headerName: 'Depth', field: 'depth', flex: 1, 
      valueFormatter: (params) => params.value ? Number(params.value).toLocaleString() : '', 
      cellStyle: { color: '#1e40af', fontWeight: '500', borderRight: '1px solid #e2e8f0' } 
    },
    { 
      headerName: 'Remarks', field: 'remarks', flex: 2, 
      cellStyle: { color: '#1e40af', textTransform: 'uppercase', fontSize: '12px' } 
    }
  ];

  public defaultColDef: ColDef = {
    resizable: false, sortable: false, filter: false,
    cellClass: 'text-center flex justify-center items-center'
  };

  // Enterprise Best Practice: Tells AG grid how to track rows so it doesn't destroy the DOM on data swaps
  public getRowId = (params: GetRowIdParams) => params.data.formation;
}
====
<div class="relative transition-all duration-300 w-full rounded-xl overflow-hidden shadow-md border border-blue-100 flex flex-col min-h-[250px]"
     [class.opacity-40]="store.isLoading()"
     [class.pointer-events-none]="store.isLoading()">

  @if (store.isLoading()) {
    <div class="absolute inset-0 z-20 flex items-center justify-center bg-white/30 backdrop-blur-[1px]">
      <div class="bg-white/90 p-2 rounded-full shadow-lg">
        <i class="fa-solid fa-circle-notch fa-spin text-2xl text-blue-600"></i>
      </div>
    </div>
  }

  <div class="bg-gradient-to-r from-blue-700 via-blue-500 to-blue-400 p-3 text-center border-b-2 border-cyan-400 z-10">
    <h2 class="text-white text-xl font-light tracking-wide">Picked Formation</h2>
  </div>

  <ag-grid-angular
    class="ag-theme-alpine w-full"
    style="width: 100%"
    [rowData]="store.viewModel().pickedFormations"
    [columnDefs]="colDefs"
    [defaultColDef]="defaultColDef"
    [domLayout]="'autoHeight'"
    [animateRows]="true" 
    [getRowId]="getRowId"
    [headerHeight]="40"
    [rowHeight]="40">
  </ag-grid-angular>
</div>
