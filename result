import { Component, computed, inject, OnInit } from '@angular/core';
import { wellDataStore } from '../../../core/stores/wwell-data/wwell-data.store';
import { MorningReportStore } from '../../../core/stores/moringreport/morning-report.store';
import { CommonModule } from '@angular/common';

@Component({
  selector: 'app-misc-pres-well-data',
  standalone: true,
  imports: [CommonModule],
  templateUrl: './misc-pres-well-data.component.html',
  styleUrl: './misc-pres-well-data.component.scss'
})
export class MiscPresWellDataComponent implements OnInit {
  private readonly wellStore = inject(wellDataStore);
  private readonly reportStore = inject(MorningReportStore);

  // Selector: Dynamically finds the well in the detail array based on chip selection
  readonly selectedWellData = computed(() => {
    const selectedId = this.reportStore.selectedWellId(); // Value from Chip
    const response = this.wellStore.response();

    if (!selectedId || !response?.data) return null;

    // We search the array for the item matching the ID
    return response.data.find(item => {
      // Access the ID from the specific nested location in your JSON
      const detailedId = item.DRLG_OP_STATUS?.[0]?.epANum;
      
      // Compare dynamic values, converting both to strings to be safe
      return String(detailedId) === String(selectedId);
    }) ?? null;
  });

  ngOnInit(): void {
    // Only load if data is not already present
    if (!this.wellStore.response()) {
      this.wellStore.loadWellData();
    }
  }

  refreshWelldata(): void {
    this.wellStore.refresh();
  }
}
